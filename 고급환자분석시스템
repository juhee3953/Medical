from typing import List, Dict, Callable
from functools import reduce
import time

def measure_performance(func: Callable) -> Callable:
    """ì„±ëŠ¥ ì¸¡ì • ë°ì½”ë ˆì´í„°"""
    def wrapper(*args, **kwargs):
        start = time.time()
        result = func(*args, **kwargs)
        elapsed = time.time() - start
        print(f"â±ï¸ {func.__name__}: {elapsed:.4f}ì´ˆ")
        return result
    return wrapper

class PatientAnalytics:
    """ê³ ê¸‰ í™˜ì ë°ì´í„° ë¶„ì„"""
    
    def __init__(self, patients: List[Dict]):
        self.patients = patients
    
    @measure_performance
    def filter_by_condition(self, condition: Callable[[Dict], bool]) -> List[Dict]:
        """ì¡°ê±´ì— ë§ëŠ” í™˜ì í•„í„°ë§"""
        return [p for p in self.patients if condition(p)]
    
    @measure_performance
    def group_by_field(self, field: str) -> Dict[str, List[Dict]]:
        """íŠ¹ì • í•„ë“œë¡œ ê·¸ë£¹í™”"""
        groups = {}
        for patient in self.patients:
            key = patient.get(field, "Unknown")
            if key not in groups:
                groups[key] = []
            groups[key].append(patient)
        return groups
    
    @measure_performance
    def aggregate(self, field: str, operation: Callable) -> float:
        """ì§‘ê³„ í•¨ìˆ˜"""
        values = [p[field] for p in self.patients if field in p]
        return operation(values) if values else 0
    
    def pipeline(self, *operations):
        """ì—¬ëŸ¬ ì—°ì‚°ì„ ìˆœì°¨ ì‹¤í–‰"""
        result = self.patients
        for operation in operations:
            result = operation(result)
        return result

# í…ŒìŠ¤íŠ¸ ë°ì´í„°
patients = [
    {"name": "ê¹€ì² ìˆ˜", "age": 45, "blood_type": "A", "fever": True, "temperature": 38.5},
    {"name": "ì´ì˜í¬", "age": 30, "blood_type": "B", "fever": False, "temperature": 36.8},
    {"name": "ë°•ë¯¼ìˆ˜", "age": 55, "blood_type": "A", "fever": True, "temperature": 39.1},
    {"name": "ìµœìˆ˜ì§„", "age": 38, "blood_type": "O", "fever": False, "temperature": 37.2},
    {"name": "ì •ë¯¼í˜¸", "age": 28, "blood_type": "AB", "fever": True, "temperature": 38.3}
]

analytics = PatientAnalytics(patients)

# ë°œì—´ í™˜ì í•„í„°ë§
print("\nğŸ” ë°œì—´ í™˜ì í•„í„°ë§:")
fever_patients = analytics.filter_by_condition(lambda p: p["fever"])
print([p["name"] for p in fever_patients])

# í˜ˆì•¡í˜•ë³„ ê·¸ë£¹í™”
print("\nğŸ©¸ í˜ˆì•¡í˜•ë³„ ê·¸ë£¹í™”:")
by_blood_type = analytics.group_by_field("blood_type")
for blood_type, group in by_blood_type.items():
    print(f"{blood_type}í˜•: {len(group)}ëª…")

# í‰ê·  ë‚˜ì´ ê³„ì‚°
print("\nğŸ“Š í‰ê·  ë‚˜ì´:")
avg_age = analytics.aggregate("age", lambda values: sum(values) / len(values))
print(f"{avg_age:.1f}ì„¸")

# ìµœê³  ì²´ì˜¨
print("\nğŸŒ¡ï¸ ìµœê³  ì²´ì˜¨:")
max_temp = analytics.aggregate("temperature", max)
print(f"{max_temp}Â°C")

# íŒŒì´í”„ë¼ì¸ ì˜ˆì œ
print("\nâš™ï¸ íŒŒì´í”„ë¼ì¸ ì²˜ë¦¬:")
result = analytics.pipeline(
    lambda data: [p for p in data if p["age"] > 35],  # 35ì„¸ ì´ìƒ
    lambda data: [p for p in data if p["fever"]],     # ë°œì—´ ìˆìŒ
    lambda data: sorted(data, key=lambda x: x["temperature"], reverse=True)  # ì²´ì˜¨ìˆœ ì •ë ¬
)
print("35ì„¸ ì´ìƒ ë°œì—´ í™˜ì (ì²´ì˜¨ìˆœ):")
for p in result:
    print(f"  {p['name']}: {p['temperature']}Â°C")
